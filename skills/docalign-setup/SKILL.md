---
name: docalign-setup
description: >
  Interactive setup wizard for DocAlign.
  Guides user through: doc discovery â†’ selection â†’ configuration â†’
  document annotation â†’ initial scan.
  Safe to re-run after partial completion â€” already-processed documents are skipped.
  After setup fully completes, this skill becomes inactive and docalign skill takes over.
metadata:
  author: DocAlign
  version: 0.3.0
  trigger: config_missing
---

# DocAlign Interactive Setup

## Auto-Trigger Condition

**CHECK IMMEDIATELY ON LOAD:**

1. Does `.docalign/.setup-complete` exist?
   - **IF YES:** Setup fully complete. Do nothing (docalign skill will handle usage).

2. Does `.docalign/config.yml` exist (but no `.setup-complete`)?
   - **IF YES:** Previous setup was interrupted (partial run). Tell the user:
     ```
     Found a partial DocAlign setup. Resuming â€” already-processed documents will be skipped automatically.
     ```
     Then begin the Setup Wizard from Phase 1. (Phases 1-2 re-run so the user can adjust doc selection. In Phase 3, sub-agents skip docs that already have a semantic JSON file.)

3. Neither file exists?
   - This is first-time setup. Begin "Setup Wizard" from Phase 1.

---

## Setup Wizard (4 Phases)

### Phase 1: Discovery & Document Selection

**Step 1.1: Welcome & Discovery**

Say to user:

```
ğŸ‘‹ Welcome to DocAlign!

I can help you keep documentation in sync with your code. Let me start by
discovering what documentation you have in this project.

Scanning for documentation files...
```

**Step 1.2: Discover Documentation**

1. Run targeted globs first (these must never be missed), then the broad sweep:
   - `docs/**/*.md` and `docs/**/*.mdx` â€” always run explicitly
   - `README.md`, `CONTRIBUTING.md`, `CHANGELOG.md` â€” root-level standalones
   - `**/*.md` and `**/*.mdx` â€” broad sweep to catch everything else

   **Why targeted first:** the broad glob returns at most 100 results and truncates on
   large repos. Running `docs/**/*.md` explicitly guarantees the docs/ directory is
   always fully represented even when the broad glob is cut off.

   Deduplicate results across all glob calls. Exclude from all results:
   node_modules/**, .git/**, dist/**, build/**

2. Categorize each doc:
   - **Core docs:** README.md, docs/\*_/_.md, API docs
   - **Changelog:** CHANGELOG.md, HISTORY.md, NEWS.md
   - **Backlog/Planning:** tasks/**, backlog/**, planning/\*\*
   - **Legacy:** docs/legacy/**, docs/archive/**
   - **Examples:** examples/**, tutorials/**

3. Calculate token estimates:
   - Read first 100 lines of each core doc to estimate size
   - Rough formula: 1 token â‰ˆ 4 characters
   - Group by category

**Step 1.3: Present Interactive Selection**

Use interactive UI to present multi-select:

```
ğŸ“š Documentation Discovery Complete

Found 12 documentation files:

â”Œâ”€ Core Documentation (Recommended) â”€â”
â”‚ [âœ“] README.md                 500 tokens  â”‚
â”‚ [âœ“] docs/api.md              1200 tokens  â”‚
â”‚ [âœ“] docs/setup.md             800 tokens  â”‚
â”‚ [âœ“] docs/architecture.md     1500 tokens  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ Auto-Generated (Usually Skip) â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [âœ—] CHANGELOG.md              300 tokens  â”‚
â”‚ [âœ—] LICENSE.md                200 tokens  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ Internal/Planning (Usually Skip) â”€â”€â”€â”€â”€â”
â”‚ [âœ—] tasks/backlog.md          400 tokens  â”‚
â”‚ [âœ—] planning/roadmap.md       600 tokens  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ Legacy/Archive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [?] docs/legacy/v1-api.md    1000 tokens  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Estimated tokens for initial scan: ~5,000

[Actions]
â€¢ Click to toggle selection
â€¢ "all" - monitor all docs
â€¢ "core" - monitor only core docs
â€¢ "done" - confirm selection
```

**Step 1.4: Handle User Input**

- User clicks/toggles individual docs
- Or types: "all", "core", "skip 3,7", "done"
- Validate: at least 1 doc selected
- Show updated token estimate

**Step 1.5: Confirm Selection**

Say:

```
âœ… Selection confirmed:
â€¢ Monitoring: 8 docs (~5,000 tokens)
â€¢ Skipping: 4 docs (changelog, internal)

Ready to proceed to configuration?
```

Wait for user confirmation, then proceed immediately.

---

### Phase 2: Configuration & Headers

**Step 2.1: Generate Configuration**

1. Create `.docalign/config.yml`:

```yaml
# DocAlign Configuration
# Generated by interactive setup

doc_patterns:
  include:
    # Core documentation (user selected)
    - README.md
    - docs/**/*.md
    - [other selected docs...]

  exclude:
    # Auto-generated files
    - CHANGELOG.md
    - CHANGELOG-*.md
    - HISTORY.md
    - NEWS.md
    - LICENSE.md

    # Internal planning
    - tasks/**
    - backlog/**
    - planning/**

    # Build artifacts
    - node_modules/**
    - dist/**
    - build/**

code_patterns:
  include:
    - "**"
  exclude:
    - node_modules/**
    - .git/**
    - dist/**
    - build/**
    - coverage/**

verification:
  min_severity: low
  max_claims_per_pr: 50

llm:
  verification_model: claude-sonnet-4-20250514
  extraction_model: claude-sonnet-4-20250514
```

2. Write config file using Write tool

**Step 2.2: Ask to Write Document Headers**

Before writing any headers, ask:

```
ğŸ“ Optional: YAML frontmatter headers

I can add a small metadata block to the top of each monitored document:

  ---
  title: "Getting Started"
  summary: "Walks new users through installation and first run."
  category: guide
  read_when:
    - Setting up the project for the first time
    - Troubleshooting installation issues
  related:
    - docs/reference/cli.md
  docalign:
    monitored: true
  ---

This is entirely optional. It helps AI agents (and humans) quickly
understand what each doc is for and when to read it â€” without opening
the file. It does not affect how drift detection works.

Add YAML headers to your docs? [yes / no]
```

**IF user says yes:** write headers to all selected documents using the process below.

**IF user says no:** skip this step entirely and proceed to Step 2.3.

**Header writing process (when approved):**

For EACH selected document, read the document first to understand its content, then write:

```markdown
---
title: "[Extracted from doc]"
summary: "[2-3 sentence summary of purpose]"
description: "[Detailed description of what this doc covers]"
category: "[tutorial|reference|api|architecture|guide]"
read_when:
  - [Specific scenario when user should read this]
  - [Another scenario]
related:
  - [relative/path/to/related-doc.md]
  - [another/related/doc.md]
docalign:
  setup_date: "2024-01-15T10:30:00Z"
  monitored: true
---

[Original document content follows...]
```

**Process per doc:**

1. Read existing content
2. Analyze: What is this doc about?
3. Extract/generate metadata (title, summary, category)
4. Identify related docs (files that reference each other)
5. Write header + original content back

**Step 2.3: Report Progress**

Say (adapt based on whether headers were written):

```
âœ… Configuration saved to .docalign/config.yml
âœ… Headers written to 8 documents   â† omit this line if user declined headers

Next: Processing documents to extract claims and add annotations...
```

---

### Phase 3: Document Processing (Parallel Sub-Agents)

**Step 3.1: Ask user for concurrency limit**

Before doing anything else, tell the user how many documents need processing and ask:

```
Ready to process {N} documents. Each document is handled by a parallel sub-agent.

How many sub-agents should run at once?

[1] Conservative â€” 3 at a time  (slow but light on RAM/CPU)
[2] Balanced    â€” 5 at a time  (recommended for most machines)
[3] Fast        â€” 10 at a time (good if you have 16 GB+ RAM)
[4] Custom      â€” enter a number

Running too many in parallel can exhaust memory on large repos.
```

Use the user's answer as the **batch size** for Step 3.3.
If the user picks Custom, accept any integer between 1 and 20.
Default to 5 if the user skips the question.

**Step 3.2: Prepare context, then spawn sub-agents**

Before spawning, do this once:
1. Read the sub-agent spec. Check these locations in order and use the first that exists:
   - `.claude/skills/docalign-setup/document-processor.md` (project-level, installed by `docalign init`)
   - `~/.claude/skills/docalign-setup/document-processor.md` (user-level, installed by `docalign init`)
   - `skills/docalign-setup/document-processor.md` (repo-relative fallback for docalign dev repo)
2. Create the output directory so sub-agents don't race to create it:
   ```bash
   mkdir -p .docalign/semantic
   ```
3. **Filter already-processed documents.** List existing `.json` files in `.docalign/semantic/`. For each selected document, compute its expected JSON filename (replace `/` with `--`, append `.json`). If the JSON file exists and is non-empty, that document was already fully processed â€” remove it from the list. Report to the user:
   ```
   Found {N} already-processed documents â€” skipping those.
   Remaining: {M} documents to process.
   ```
   If ALL documents are already processed, skip directly to Phase 4.

Then spawn one Task sub-agent per **remaining** document. Use the context you already have from Phase 2 (you read each document when writing its YAML header) to populate the dynamic context block:

```
Read the Document Processor spec at: {absolute_path_to_document_processor_md}

Then process this document according to that spec.

Document: {file_path}
Repository root: {absolute_repo_root}

--- Dynamic context ---
{Add what you observed from briefly scanning the document, e.g.:}
- Source directories referenced in this doc: src/layers/L1-claim-extractor/, src/cli/
- Specific files mentioned: src/cli/real-pipeline.ts, package.json
- Package manager: npm
- Primary language: TypeScript (strict)
- Any other notes relevant to finding evidence for claims in this doc
```

2. Please ensure that the dynamic context you provide to each sub-agent is complete, relevant, and self-contained to provide the subagent with sufficient information to perform its task correctly.

 
**Step 3.3: Batched Parallel Execution**

Split the document list into batches of the chosen size. For each batch:
1. Spawn all agents in the batch in a **single message** (parallel)
2. Wait for all of them to finish before starting the next batch
3. After each batch, report progress using this format:

```
â”â”â” Batch 2/4 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  âœ… docs/api.md                 14 claims extracted
  âœ… docs/setup.md                8 claims extracted
  âœ… docs/architecture.md        11 claims extracted
  â­ï¸  docs/guides/mcp.md          already processed

  Progress: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 10/19 docs

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

Use âœ… for successful, â­ï¸ for skipped (already processed), âŒ for failed. Build the progress bar proportionally: each â–ˆ = 5% done, each â–‘ = 5% remaining (20 chars total).

**Step 3.4: Retry Logic**

**IF a sub-agent fails:**

1. Log the failure
2. Wait 2 seconds
3. Retry the same sub-agent (up to 3 attempts)
4. If still failing after 3 retries:
   - Mark doc as "failed"
   - Continue with other docs
   - Report to user at end

**Step 3.5: Collect Results**

As sub-agents complete, parse each sub-agent's report to extract: claim counts by type, evidence counts, skip region counts. Aggregate across all documents.

Present the final summary using this format:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ğŸ“‹ Document Processing Complete            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  Documents             19 total                     â”‚
â”‚    âœ… Processed:       17                           â”‚
â”‚    â­ï¸  Skipped:         2  (already done)           â”‚
â”‚    âŒ Failed:           0                           â”‚
â”‚                                                     â”‚
â”‚  Claims Extracted     150 total                     â”‚
â”‚    ğŸ” behavior          87                          â”‚
â”‚    ğŸ—ï¸  architecture      34                          â”‚
â”‚    âš™ï¸  config            29                          â”‚
â”‚                                                     â”‚
â”‚  Evidence                                           â”‚
â”‚    âœ… With evidence:  132  (88%)                    â”‚
â”‚    âš ï¸  No evidence:    18  (12%) â€” likely drifted   â”‚
â”‚                                                     â”‚
â”‚  Skip Regions          45 illustrative blocks       â”‚
â”‚                        tagged across all docs       â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Fill in real numbers from the sub-agent reports. Adjust column widths to fit actual data. If any documents failed, list them under the âŒ line.

---

### Phase 4: Initial Scan

**Step 4.1: Offer Initial Scan**

Say:

```
ğŸ‰ Setup nearly complete!

Your documentation is now configured and annotated. Let's verify everything
is working with an initial scan.

Choose scan scope:

[1] Quick Demo - Check README only (~30 seconds)
    Great for seeing how results look

[2] Fast Scan - Check all selected docs (~2 minutes)
    Full verification of your documentation

[3] Skip for now - Complete setup, scan later
    You can run "docalign scan" anytime

Enter 1, 2, or 3:
```

**Step 4.2: Execute Scan**

**IF user chooses 1 (Quick Demo):**

```
Running quick check on README.md...
```

Call MCP tool: `check_doc` with file="README.md", deep=true

Present results using this format (fill in real data from the tool response):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ğŸ“Š README.md â€” Health Check                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  Health Score  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  80/100          â”‚
â”‚                                                     â”‚
â”‚  Claims: 15 total                                   â”‚
â”‚    âœ… Verified:   12  (80%)                         â”‚
â”‚    âš ï¸  Drifted:     2  (13%)                        â”‚
â”‚    â“ Uncertain:   1  ( 7%)                         â”‚
â”‚                                                     â”‚
â”œâ”€â”€â”€ Drifted Claims â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  Line 23 â”‚ Path "src/auth.ts" not found             â”‚
â”‚          â”‚ ğŸ’¡ Did you mean src/authentication.ts?   â”‚
â”‚          â”‚                                          â”‚
â”‚  Line 45 â”‚ Script "npm run deploy" not in           â”‚
â”‚          â”‚ package.json                              â”‚
â”‚          â”‚ ğŸ’¡ Add script or update docs             â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Build the health score bar proportionally: each â–ˆ = 5%, 20 chars total. Use real line numbers and claim text from the `check_doc` response. Only show the drifted claims section if there are drifted claims.

**IF user chooses 2 (Fast Scan):**

```
Running full scan on all selected docs...
```

For each doc, call `check_doc` and aggregate results. Present using this format:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ğŸ“Š Documentation Health Report             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  Overall Health  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  87/100       â”‚
â”‚                                                     â”‚
â”‚  Document                Claims   Verified  Status  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  README.md                  15      93%       âœ…    â”‚
â”‚  docs/api.md                42      88%       âœ…    â”‚
â”‚  docs/architecture.md       31      97%       âœ…    â”‚
â”‚  docs/setup.md              23      78%       âš ï¸    â”‚
â”‚  docs/config.md             18     100%       âœ…    â”‚
â”‚                                                     â”‚
â”œâ”€â”€â”€ Top Issues (up to 5) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  1. docs/setup.md:34                                â”‚
â”‚     âš ï¸  Command "npm run deploy" â€” script not found â”‚
â”‚                                                     â”‚
â”‚  2. docs/api.md:128                                 â”‚
â”‚     âš ï¸  Parameter "userId" â€” not in signature      â”‚
â”‚                                                     â”‚
â”‚  3. docs/setup.md:56                                â”‚
â”‚     âš ï¸  Version "3.2.1" â€” package.json has "4.0.0" â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Sort the document table by verified % ascending (worst first). Use âœ… for â‰¥85% verified, âš ï¸ for <85%. Show up to 5 top issues, prioritizing drifted claims. If all docs are 100% verified, replace the "Top Issues" section with: "ğŸ‰ No issues found â€” all documentation is in sync!"

**Step 4.3: Clean Up Setup Trigger**

Remove the auto-trigger notice from `CLAUDE.md`:

1. Read `CLAUDE.md` from the project root
2. Remove the block between `<!-- docalign:setup-pending -->` and `<!-- /docalign:setup-pending -->` (inclusive, including the trailing blank line)
3. Write the updated content back
4. If `CLAUDE.md` is now empty, delete it

**Step 4.4: Write Completion Marker**

Write the file `.docalign/.setup-complete` with the current ISO timestamp. This marker signals that setup finished successfully and prevents the wizard from re-triggering.

```bash
date -u +"%Y-%m-%dT%H:%M:%SZ" > .docalign/.setup-complete
```

**Step 4.5: Final Summary**

Present the final summary using this format (fill in real numbers):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             âœ… DocAlign Setup Complete!              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  What was created                                   â”‚
â”‚    ğŸ“„ Config       .docalign/config.yml             â”‚
â”‚    ğŸ“š Monitored    19 documentation files           â”‚
â”‚    ğŸ” Claims       150 semantic claims indexed      â”‚
â”‚    ğŸ“ Store        .docalign/semantic/              â”‚
â”‚                                                     â”‚
â”‚  What happens next                                  â”‚
â”‚    After you edit code, I'll suggest checking        â”‚
â”‚    related docs for drift. You can also run:        â”‚
â”‚                                                     â”‚
â”‚    docalign scan    check all docs                  â”‚
â”‚    docalign check   verify a single file            â”‚
â”‚    docalign fix     apply suggested corrections     â”‚
â”‚                                                     â”‚
â”‚  The docalign skill is now active. ğŸš€              â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Error Handling

### Document Processing Failures

**IF sub-agent fails:**

1. **First failure:** Retry immediately
2. **Second failure:** Wait 2 seconds, retry
3. **Third failure:**
   - Mark as permanent failure
   - Add to `.docalign/failed-docs.json`
   - Continue with other docs
   - Report at end: "1 doc failed processing (will retry on next scan)"

### User Cancellation

**IF user cancels during setup:**

1. Stop current operation gracefully
2. Save partial progress to `.docalign/config.yml`
3. Say: "Setup paused. Run 'docalign init' to continue."

### Missing Tools

**IF MCP tools unavailable:**

Say:

```
âš ï¸  DocAlign MCP server not connected.

Please ensure:
1. DocAlign is installed: npm install -g docalign
2. Run: docalign init (to configure MCP)
3. Restart Claude Code
```

---

## Post-Setup Transition

After setup completes successfully:

1. `.docalign/config.yml` now exists
2. `.docalign/.setup-complete` marker written (prevents wizard from re-triggering)
3. This skill becomes inactive (trigger condition no longer met)
4. User restarts Claude Code
5. **docalign skill** (daily usage) becomes active
6. Normal workflows begin (post-change checks, health monitoring, etc.)

---

## Key Design Principles

1. **Transparent:** User sees every step, understands what's happening
2. **Educational:** Explains token costs, claim types, why certain docs are skipped
3. **Forgiving:** Retry logic, can resume if interrupted
4. **Progressive:** Demo option lets user see value before full scan
5. **Parallel:** Sub-agents process docs simultaneously for speed
